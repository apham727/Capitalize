'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _qs = require('qs');

var _qs2 = _interopRequireDefault(_qs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * A Request object containing all the compiled information about this request.
 *
 * @property {string} host the host used for this API call
 * @property {number} port the port for this API call. Standard set to 443.
 * @property {boolean} ssl wether this API call uses SSL
 * @property {string} scheme the scheme inferred from the SSL state
 * @property {string} verb the HTTP method, for example `GET` or `POST`
 * @property {string} path the full path of the API endpoint
 * @property {Object} params the parameters to pass in the query or body
 * @property {string} queryPath the path and query string used for the API call
 * @property {string} bearerToken the authentication token
 * @property {string} clientVersion the version of the Amadeus library
 * @property {string} languageVersion the version of Node used
 * @property {string} appId the custom ID of the application using this library
 * @property {string} appVersion the custom version of the application
 *  using this library
 * @property {Object} headers the request headers
 *
 * @param {Object} options
 */
var Request = function () {
  function Request(options) {
    _classCallCheck(this, Request);

    this.host = options.host;
    this.port = options.port;
    this.ssl = options.ssl;
    this.scheme = this.ssl ? 'https' : 'http';
    this.verb = options.verb;
    this.path = options.path;
    this.params = options.params;
    this.queryPath = this.fullQueryPath();
    this.bearerToken = options.bearerToken;
    this.clientVersion = options.clientVersion;
    this.languageVersion = options.languageVersion.replace('v', '');
    this.appId = options.appId;
    this.appVersion = options.appVersion;
    this.headers = {
      'User-Agent': this.userAgent(),
      'Accept': 'application/json, application/vnd.amadeus+json'
    };
    this.addAuthorizationHeader();
    this.addContentTypeHeader();
  }

  // PROTECTED

  /**
   * Compiles the options for the HTTP request.
   *
   * Used by Client.execute when executing this request against the server.
   *
   * @return {Object} an associative array of options to be passed into the
   *  Client.execute function
   * @protected
   */


  _createClass(Request, [{
    key: 'options',
    value: function options() {
      var options = {
        'host': this.host,
        'port': this.port,
        'protocol': `${this.scheme}:`,
        'path': this.queryPath,
        'method': this.verb,
        'headers': this.headers
      };
      return options;
    }

    /**
     * Creats the body for the API cal, serializing the params if the verb is POST.
     *
     * @return {string} the serialized params
     * @protected
     */

  }, {
    key: 'body',
    value: function body() {
      if (this.verb !== 'POST') {
        return '';
      } else {
        return _qs2.default.stringify(this.params);
      }
    }

    // PRIVATE

    /**
     * Build up the custom User Agent
     *
     * @return {string} a user agent in the format "library/version language/version app/version"
     * @private
     */

  }, {
    key: 'userAgent',
    value: function userAgent() {
      var userAgent = `amadeus-node/${this.clientVersion} node/${this.languageVersion}`;
      if (!this.appId) {
        return userAgent;
      }
      return `${userAgent} ${this.appId}/${this.appVersion}`;
    }

    /**
     * Build the full query path, combining the path with the query params if the
     * verb is 'GET'. For example: '/foo/bar?baz=qux'
     *
     * @return {string} the path and params combined into one string.
     * @private
     */

  }, {
    key: 'fullQueryPath',
    value: function fullQueryPath() {
      if (this.verb === 'POST') {
        return this.path;
      } else {
        return `${this.path}?${_qs2.default.stringify(this.params)}`;
      }
    }

    /**
     * Adds an Authorization header if the BearerToken is present
     *
     * @private
     */

  }, {
    key: 'addAuthorizationHeader',
    value: function addAuthorizationHeader() {
      if (!this.bearerToken) {
        return;
      }
      this.headers['Authorization'] = `Bearer ${this.bearerToken}`;
    }

    /**
     * Adds an Content-Type header if the HTTP method equals POST
     *
     * @private
     */

  }, {
    key: 'addContentTypeHeader',
    value: function addContentTypeHeader() {
      if (this.verb !== 'POST') {
        return;
      }
      this.headers['Content-Type'] = 'application/x-www-form-urlencoded';
    }
  }]);

  return Request;
}();

exports.default = Request;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hbWFkZXVzL2NsaWVudC9yZXF1ZXN0LmpzIl0sIm5hbWVzIjpbIlJlcXVlc3QiLCJvcHRpb25zIiwiaG9zdCIsInBvcnQiLCJzc2wiLCJzY2hlbWUiLCJ2ZXJiIiwicGF0aCIsInBhcmFtcyIsInF1ZXJ5UGF0aCIsImZ1bGxRdWVyeVBhdGgiLCJiZWFyZXJUb2tlbiIsImNsaWVudFZlcnNpb24iLCJsYW5ndWFnZVZlcnNpb24iLCJyZXBsYWNlIiwiYXBwSWQiLCJhcHBWZXJzaW9uIiwiaGVhZGVycyIsInVzZXJBZ2VudCIsImFkZEF1dGhvcml6YXRpb25IZWFkZXIiLCJhZGRDb250ZW50VHlwZUhlYWRlciIsInFzIiwic3RyaW5naWZ5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7OztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFxQk1BLE87QUFDSixtQkFBWUMsT0FBWixFQUFxQjtBQUFBOztBQUNuQixTQUFLQyxJQUFMLEdBQXVCRCxRQUFRQyxJQUEvQjtBQUNBLFNBQUtDLElBQUwsR0FBdUJGLFFBQVFFLElBQS9CO0FBQ0EsU0FBS0MsR0FBTCxHQUF1QkgsUUFBUUcsR0FBL0I7QUFDQSxTQUFLQyxNQUFMLEdBQXVCLEtBQUtELEdBQUwsR0FBVyxPQUFYLEdBQXFCLE1BQTVDO0FBQ0EsU0FBS0UsSUFBTCxHQUF1QkwsUUFBUUssSUFBL0I7QUFDQSxTQUFLQyxJQUFMLEdBQXVCTixRQUFRTSxJQUEvQjtBQUNBLFNBQUtDLE1BQUwsR0FBdUJQLFFBQVFPLE1BQS9CO0FBQ0EsU0FBS0MsU0FBTCxHQUF1QixLQUFLQyxhQUFMLEVBQXZCO0FBQ0EsU0FBS0MsV0FBTCxHQUF1QlYsUUFBUVUsV0FBL0I7QUFDQSxTQUFLQyxhQUFMLEdBQXVCWCxRQUFRVyxhQUEvQjtBQUNBLFNBQUtDLGVBQUwsR0FBdUJaLFFBQVFZLGVBQVIsQ0FBd0JDLE9BQXhCLENBQWdDLEdBQWhDLEVBQXFDLEVBQXJDLENBQXZCO0FBQ0EsU0FBS0MsS0FBTCxHQUF1QmQsUUFBUWMsS0FBL0I7QUFDQSxTQUFLQyxVQUFMLEdBQXVCZixRQUFRZSxVQUEvQjtBQUNBLFNBQUtDLE9BQUwsR0FBdUI7QUFDckIsb0JBQWUsS0FBS0MsU0FBTCxFQURNO0FBRXJCLGdCQUFXO0FBRlUsS0FBdkI7QUFJQSxTQUFLQyxzQkFBTDtBQUNBLFNBQUtDLG9CQUFMO0FBQ0Q7O0FBRUQ7O0FBRUE7Ozs7Ozs7Ozs7Ozs7OEJBU1U7QUFDUixVQUFJbkIsVUFBVTtBQUNaLGdCQUFTLEtBQUtDLElBREY7QUFFWixnQkFBUyxLQUFLQyxJQUZGO0FBR1osb0JBQWMsR0FBRSxLQUFLRSxNQUFPLEdBSGhCO0FBSVosZ0JBQVMsS0FBS0ksU0FKRjtBQUtaLGtCQUFXLEtBQUtILElBTEo7QUFNWixtQkFBWSxLQUFLVztBQU5MLE9BQWQ7QUFRQSxhQUFPaEIsT0FBUDtBQUNEOztBQUVEOzs7Ozs7Ozs7MkJBTU87QUFDTCxVQUFJLEtBQUtLLElBQUwsS0FBYyxNQUFsQixFQUEwQjtBQUFFLGVBQU8sRUFBUDtBQUFZLE9BQXhDLE1BQ0s7QUFBRSxlQUFPZSxhQUFHQyxTQUFILENBQWEsS0FBS2QsTUFBbEIsQ0FBUDtBQUFtQztBQUMzQzs7QUFFRDs7QUFFQTs7Ozs7Ozs7O2dDQU1ZO0FBQ1YsVUFBSVUsWUFBYSxnQkFBZSxLQUFLTixhQUFjLFNBQVEsS0FBS0MsZUFBZ0IsRUFBaEY7QUFDQSxVQUFJLENBQUMsS0FBS0UsS0FBVixFQUFpQjtBQUFFLGVBQU9HLFNBQVA7QUFBbUI7QUFDdEMsYUFBUSxHQUFFQSxTQUFVLElBQUcsS0FBS0gsS0FBTSxJQUFHLEtBQUtDLFVBQVcsRUFBckQ7QUFDRDs7QUFFRDs7Ozs7Ozs7OztvQ0FPZ0I7QUFDZCxVQUFJLEtBQUtWLElBQUwsS0FBYyxNQUFsQixFQUEwQjtBQUFFLGVBQU8sS0FBS0MsSUFBWjtBQUFtQixPQUEvQyxNQUNLO0FBQUUsZUFBUSxHQUFFLEtBQUtBLElBQUssSUFBR2MsYUFBR0MsU0FBSCxDQUFhLEtBQUtkLE1BQWxCLENBQTBCLEVBQWpEO0FBQXFEO0FBQzdEOztBQUVEOzs7Ozs7Ozs2Q0FLeUI7QUFDdkIsVUFBSSxDQUFDLEtBQUtHLFdBQVYsRUFBdUI7QUFBRTtBQUFTO0FBQ2xDLFdBQUtNLE9BQUwsQ0FBYSxlQUFiLElBQWlDLFVBQVMsS0FBS04sV0FBWSxFQUEzRDtBQUNEOztBQUVEOzs7Ozs7OzsyQ0FLdUI7QUFDckIsVUFBSSxLQUFLTCxJQUFMLEtBQWMsTUFBbEIsRUFBMEI7QUFBRTtBQUFTO0FBQ3JDLFdBQUtXLE9BQUwsQ0FBYSxjQUFiLElBQStCLG1DQUEvQjtBQUNEOzs7Ozs7a0JBR1lqQixPIiwiZmlsZSI6InJlcXVlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcXMgZnJvbSAncXMnO1xuXG4vKipcbiAqIEEgUmVxdWVzdCBvYmplY3QgY29udGFpbmluZyBhbGwgdGhlIGNvbXBpbGVkIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgcmVxdWVzdC5cbiAqXG4gKiBAcHJvcGVydHkge3N0cmluZ30gaG9zdCB0aGUgaG9zdCB1c2VkIGZvciB0aGlzIEFQSSBjYWxsXG4gKiBAcHJvcGVydHkge251bWJlcn0gcG9ydCB0aGUgcG9ydCBmb3IgdGhpcyBBUEkgY2FsbC4gU3RhbmRhcmQgc2V0IHRvIDQ0My5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gc3NsIHdldGhlciB0aGlzIEFQSSBjYWxsIHVzZXMgU1NMXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc2NoZW1lIHRoZSBzY2hlbWUgaW5mZXJyZWQgZnJvbSB0aGUgU1NMIHN0YXRlXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdmVyYiB0aGUgSFRUUCBtZXRob2QsIGZvciBleGFtcGxlIGBHRVRgIG9yIGBQT1NUYFxuICogQHByb3BlcnR5IHtzdHJpbmd9IHBhdGggdGhlIGZ1bGwgcGF0aCBvZiB0aGUgQVBJIGVuZHBvaW50XG4gKiBAcHJvcGVydHkge09iamVjdH0gcGFyYW1zIHRoZSBwYXJhbWV0ZXJzIHRvIHBhc3MgaW4gdGhlIHF1ZXJ5IG9yIGJvZHlcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBxdWVyeVBhdGggdGhlIHBhdGggYW5kIHF1ZXJ5IHN0cmluZyB1c2VkIGZvciB0aGUgQVBJIGNhbGxcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBiZWFyZXJUb2tlbiB0aGUgYXV0aGVudGljYXRpb24gdG9rZW5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjbGllbnRWZXJzaW9uIHRoZSB2ZXJzaW9uIG9mIHRoZSBBbWFkZXVzIGxpYnJhcnlcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBsYW5ndWFnZVZlcnNpb24gdGhlIHZlcnNpb24gb2YgTm9kZSB1c2VkXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYXBwSWQgdGhlIGN1c3RvbSBJRCBvZiB0aGUgYXBwbGljYXRpb24gdXNpbmcgdGhpcyBsaWJyYXJ5XG4gKiBAcHJvcGVydHkge3N0cmluZ30gYXBwVmVyc2lvbiB0aGUgY3VzdG9tIHZlcnNpb24gb2YgdGhlIGFwcGxpY2F0aW9uXG4gKiAgdXNpbmcgdGhpcyBsaWJyYXJ5XG4gKiBAcHJvcGVydHkge09iamVjdH0gaGVhZGVycyB0aGUgcmVxdWVzdCBoZWFkZXJzXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAqL1xuY2xhc3MgUmVxdWVzdCB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLmhvc3QgICAgICAgICAgICA9IG9wdGlvbnMuaG9zdDtcbiAgICB0aGlzLnBvcnQgICAgICAgICAgICA9IG9wdGlvbnMucG9ydDtcbiAgICB0aGlzLnNzbCAgICAgICAgICAgICA9IG9wdGlvbnMuc3NsO1xuICAgIHRoaXMuc2NoZW1lICAgICAgICAgID0gdGhpcy5zc2wgPyAnaHR0cHMnIDogJ2h0dHAnO1xuICAgIHRoaXMudmVyYiAgICAgICAgICAgID0gb3B0aW9ucy52ZXJiO1xuICAgIHRoaXMucGF0aCAgICAgICAgICAgID0gb3B0aW9ucy5wYXRoO1xuICAgIHRoaXMucGFyYW1zICAgICAgICAgID0gb3B0aW9ucy5wYXJhbXM7XG4gICAgdGhpcy5xdWVyeVBhdGggICAgICAgPSB0aGlzLmZ1bGxRdWVyeVBhdGgoKTtcbiAgICB0aGlzLmJlYXJlclRva2VuICAgICA9IG9wdGlvbnMuYmVhcmVyVG9rZW47XG4gICAgdGhpcy5jbGllbnRWZXJzaW9uICAgPSBvcHRpb25zLmNsaWVudFZlcnNpb247XG4gICAgdGhpcy5sYW5ndWFnZVZlcnNpb24gPSBvcHRpb25zLmxhbmd1YWdlVmVyc2lvbi5yZXBsYWNlKCd2JywgJycpO1xuICAgIHRoaXMuYXBwSWQgICAgICAgICAgID0gb3B0aW9ucy5hcHBJZDtcbiAgICB0aGlzLmFwcFZlcnNpb24gICAgICA9IG9wdGlvbnMuYXBwVmVyc2lvbjtcbiAgICB0aGlzLmhlYWRlcnMgICAgICAgICA9IHtcbiAgICAgICdVc2VyLUFnZW50JyA6IHRoaXMudXNlckFnZW50KCksXG4gICAgICAnQWNjZXB0JyA6ICdhcHBsaWNhdGlvbi9qc29uLCBhcHBsaWNhdGlvbi92bmQuYW1hZGV1cytqc29uJ1xuICAgIH07XG4gICAgdGhpcy5hZGRBdXRob3JpemF0aW9uSGVhZGVyKCk7XG4gICAgdGhpcy5hZGRDb250ZW50VHlwZUhlYWRlcigpO1xuICB9XG5cbiAgLy8gUFJPVEVDVEVEXG5cbiAgLyoqXG4gICAqIENvbXBpbGVzIHRoZSBvcHRpb25zIGZvciB0aGUgSFRUUCByZXF1ZXN0LlxuICAgKlxuICAgKiBVc2VkIGJ5IENsaWVudC5leGVjdXRlIHdoZW4gZXhlY3V0aW5nIHRoaXMgcmVxdWVzdCBhZ2FpbnN0IHRoZSBzZXJ2ZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge09iamVjdH0gYW4gYXNzb2NpYXRpdmUgYXJyYXkgb2Ygb3B0aW9ucyB0byBiZSBwYXNzZWQgaW50byB0aGVcbiAgICogIENsaWVudC5leGVjdXRlIGZ1bmN0aW9uXG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIG9wdGlvbnMoKSB7XG4gICAgbGV0IG9wdGlvbnMgPSB7XG4gICAgICAnaG9zdCcgOiB0aGlzLmhvc3QsXG4gICAgICAncG9ydCcgOiB0aGlzLnBvcnQsXG4gICAgICAncHJvdG9jb2wnIDogYCR7dGhpcy5zY2hlbWV9OmAsXG4gICAgICAncGF0aCcgOiB0aGlzLnF1ZXJ5UGF0aCxcbiAgICAgICdtZXRob2QnIDogdGhpcy52ZXJiLFxuICAgICAgJ2hlYWRlcnMnIDogdGhpcy5oZWFkZXJzXG4gICAgfTtcbiAgICByZXR1cm4gb3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdHMgdGhlIGJvZHkgZm9yIHRoZSBBUEkgY2FsLCBzZXJpYWxpemluZyB0aGUgcGFyYW1zIGlmIHRoZSB2ZXJiIGlzIFBPU1QuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gdGhlIHNlcmlhbGl6ZWQgcGFyYW1zXG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIGJvZHkoKSB7XG4gICAgaWYgKHRoaXMudmVyYiAhPT0gJ1BPU1QnKSB7IHJldHVybiAnJzsgfVxuICAgIGVsc2UgeyByZXR1cm4gcXMuc3RyaW5naWZ5KHRoaXMucGFyYW1zKTsgfVxuICB9XG5cbiAgLy8gUFJJVkFURVxuXG4gIC8qKlxuICAgKiBCdWlsZCB1cCB0aGUgY3VzdG9tIFVzZXIgQWdlbnRcbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBhIHVzZXIgYWdlbnQgaW4gdGhlIGZvcm1hdCBcImxpYnJhcnkvdmVyc2lvbiBsYW5ndWFnZS92ZXJzaW9uIGFwcC92ZXJzaW9uXCJcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHVzZXJBZ2VudCgpIHtcbiAgICBsZXQgdXNlckFnZW50ID0gYGFtYWRldXMtbm9kZS8ke3RoaXMuY2xpZW50VmVyc2lvbn0gbm9kZS8ke3RoaXMubGFuZ3VhZ2VWZXJzaW9ufWA7XG4gICAgaWYgKCF0aGlzLmFwcElkKSB7IHJldHVybiB1c2VyQWdlbnQ7IH1cbiAgICByZXR1cm4gYCR7dXNlckFnZW50fSAke3RoaXMuYXBwSWR9LyR7dGhpcy5hcHBWZXJzaW9ufWA7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGQgdGhlIGZ1bGwgcXVlcnkgcGF0aCwgY29tYmluaW5nIHRoZSBwYXRoIHdpdGggdGhlIHF1ZXJ5IHBhcmFtcyBpZiB0aGVcbiAgICogdmVyYiBpcyAnR0VUJy4gRm9yIGV4YW1wbGU6ICcvZm9vL2Jhcj9iYXo9cXV4J1xuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IHRoZSBwYXRoIGFuZCBwYXJhbXMgY29tYmluZWQgaW50byBvbmUgc3RyaW5nLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVsbFF1ZXJ5UGF0aCgpIHtcbiAgICBpZiAodGhpcy52ZXJiID09PSAnUE9TVCcpIHsgcmV0dXJuIHRoaXMucGF0aDsgfVxuICAgIGVsc2UgeyByZXR1cm4gYCR7dGhpcy5wYXRofT8ke3FzLnN0cmluZ2lmeSh0aGlzLnBhcmFtcyl9YDsgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYW4gQXV0aG9yaXphdGlvbiBoZWFkZXIgaWYgdGhlIEJlYXJlclRva2VuIGlzIHByZXNlbnRcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGFkZEF1dGhvcml6YXRpb25IZWFkZXIoKSB7XG4gICAgaWYgKCF0aGlzLmJlYXJlclRva2VuKSB7IHJldHVybjsgfVxuICAgIHRoaXMuaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gYEJlYXJlciAke3RoaXMuYmVhcmVyVG9rZW59YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGFuIENvbnRlbnQtVHlwZSBoZWFkZXIgaWYgdGhlIEhUVFAgbWV0aG9kIGVxdWFscyBQT1NUXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBhZGRDb250ZW50VHlwZUhlYWRlcigpIHtcbiAgICBpZiAodGhpcy52ZXJiICE9PSAnUE9TVCcpIHsgcmV0dXJuOyB9XG4gICAgdGhpcy5oZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJlcXVlc3Q7XG4iXX0=